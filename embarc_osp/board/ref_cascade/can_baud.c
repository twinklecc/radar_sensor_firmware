#include "embARC.h"
#include "embARC_debug.h"
#include "embARC_assert.h"

#include "can.h"
#include "dev_can.h"
#include "can_baud_def.h"


typedef struct can_baud_desciption {
	uint32_t clock;
	uint32_t baud;
	can_baud_t desc;
} can_baud_desc_t;

static can_baud_desc_t can_baud_info[] = {
	{CLOCK_10MHZ, CAN_BAUDRATE_100KBPS, CAN_BAUD_DESC_10MHZ_100KBPS},
	{CLOCK_10MHZ, CAN_BAUDRATE_200KBPS, CAN_BAUD_DESC_10MHZ_200KBPS},
	{CLOCK_10MHZ, CAN_BAUDRATE_250KBPS, CAN_BAUD_DESC_10MHZ_250KBPS},
	{CLOCK_10MHZ, CAN_BAUDRATE_500KBPS, CAN_BAUD_DESC_10MHZ_500KBPS},
	{CLOCK_10MHZ, CAN_BAUDRATE_1MBPS, CAN_BAUD_DESC_10MHZ_1MBPS},

	{CLOCK_20MHZ, CAN_BAUDRATE_100KBPS, CAN_BAUD_DESC_20MHZ_100KBPS},
	{CLOCK_20MHZ, CAN_BAUDRATE_200KBPS, CAN_BAUD_DESC_20MHZ_200KBPS},
	{CLOCK_20MHZ, CAN_BAUDRATE_250KBPS, CAN_BAUD_DESC_20MHZ_250KBPS},
	{CLOCK_20MHZ, CAN_BAUDRATE_500KBPS, CAN_BAUD_DESC_20MHZ_500KBPS},
	{CLOCK_20MHZ, CAN_BAUDRATE_1MBPS, CAN_BAUD_DESC_20MHZ_1MBPS},
	{CLOCK_20MHZ, CAN_BAUDRATE_2MBPS, CAN_BAUD_DESC_20MHZ_2MBPS},

	{CLOCK_40MHZ, CAN_BAUDRATE_100KBPS, CAN_BAUD_DESC_40MHZ_100KBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_200KBPS, CAN_BAUD_DESC_40MHZ_200KBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_250KBPS, CAN_BAUD_DESC_40MHZ_250KBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_500KBPS, CAN_BAUD_DESC_40MHZ_500KBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_1MBPS, CAN_BAUD_DESC_40MHZ_1MBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_2MBPS, CAN_BAUD_DESC_40MHZ_2MBPS},
	{CLOCK_40MHZ, CAN_BAUDRATE_4MBPS, CAN_BAUD_DESC_40MHZ_4MBPS},

	{CLOCK_50MHZ, CAN_BAUDRATE_100KBPS, CAN_BAUD_DESC_50MHZ_100KBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_200KBPS, CAN_BAUD_DESC_50MHZ_200KBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_250KBPS, CAN_BAUD_DESC_50MHZ_250KBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_500KBPS, CAN_BAUD_DESC_50MHZ_500KBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_1MBPS, CAN_BAUD_DESC_50MHZ_1MBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_2MBPS, CAN_BAUD_DESC_50MHZ_2MBPS},
	{CLOCK_50MHZ, CAN_BAUDRATE_4MBPS, CAN_BAUD_DESC_50MHZ_4MBPS},

	{CLOCK_100MHZ, CAN_BAUDRATE_100KBPS, CAN_BAUD_DESC_100MHZ_100KBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_200KBPS, CAN_BAUD_DESC_100MHZ_200KBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_250KBPS, CAN_BAUD_DESC_100MHZ_250KBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_500KBPS, CAN_BAUD_DESC_100MHZ_500KBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_1MBPS, CAN_BAUD_DESC_100MHZ_1MBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_2MBPS, CAN_BAUD_DESC_100MHZ_2MBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_4MBPS, CAN_BAUD_DESC_100MHZ_4MBPS},
	{CLOCK_100MHZ, CAN_BAUDRATE_5MBPS, CAN_BAUD_DESC_100MHZ_5MBPS}
};

can_baud_t *can_get_baud(uint32_t ref_clock, uint32_t baud_rate)
{
	can_baud_t *baud_desc = NULL;
	int32_t idx = 0;
	for (; idx < sizeof(can_baud_info)/sizeof(can_baud_desc_t); idx++) {
		if((ref_clock == can_baud_info[idx].clock) && \
		   (baud_rate == can_baud_info[idx].baud)) {
			baud_desc = &can_baud_info[idx].desc;
			break;
		}
	}
	return baud_desc;
}
